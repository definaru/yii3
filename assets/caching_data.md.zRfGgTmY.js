import{_ as s,c as a,o as i,V as e}from"./chunks/framework.szqEfhRr.js";const y=JSON.parse('{"title":"Data caching","description":"","frontmatter":{},"headers":[],"relativePath":"caching/data.md","filePath":"caching/data.md","lastUpdated":null}'),n={name:"caching/data.md"},t=e(`<h1 id="data-caching" tabindex="-1">Data caching <a class="header-anchor" href="#data-caching" aria-label="Permalink to &quot;Data caching&quot;">​</a></h1><p>Data caching is about storing some PHP variables in cache and retrieving it later from cache. It&#39;s also the foundation for more advanced caching features, such as <a href="./page.html">page caching</a>.</p><p>To use cache, install <a href="https://github.com/yiisoft/cache" target="_blank" rel="noreferrer">yiisoft/cache</a> package:</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">composer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> require yiisoft/cache</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>The following code is a typical usage pattern of data caching, where <code>$cache</code> refers to a <code>Cache</code> instance from the package:</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getTopProducts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\Yiisoft\\Cache\\CacheInterface</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $cache)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> array</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;top-products&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, $count </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Try retrieving $data from cache.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $cache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getOrSet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($key, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\Psr\\SimpleCache\\CacheInterface</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $cache) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ($count) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // $data isn&#39;t found in cache, calculate it from scratch.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getTopProductsFromDatabase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($count);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3600</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>When cache has data associated with the <code>$key</code>, the cached value will be returned. Otherwise, the passed anonymous function will be executed to calculate the value that will be cached and returned.</p><p>If the anonymous function requires some data from the outer scope, you can pass it with the <code>use</code> statement.</p><h2 id="cache-handlers" tabindex="-1">Cache handlers <a class="header-anchor" href="#cache-handlers" aria-label="Permalink to &quot;Cache handlers&quot;">​</a></h2><p>The cache service uses <a href="https://www.php-fig.org/psr/psr-16/" target="_blank" rel="noreferrer">PSR-16</a> compatible cache handlers which represent various cache storages, such as memory, files, databases.</p><p>Yii provides the following handlers:</p><ul><li><code>NullCache</code> - serves as a cache placeholder which does no real caching. The purpose of this handler is to simplify the code that needs to check the availability of cache. For example, during development or if the server doesn&#39;t have actual cache support, you may configure a cache service to use this handler. When you enable actual cache support, you can switch to using the corresponding cache handler. In both cases, you may use the same code without extra checks.</li><li><code>ArrayCache</code> - provides caching for the current request only by storing the values in an array.</li><li><a href="https://github.com/yiisoft/cache-apcu" target="_blank" rel="noreferrer">APCu</a> - uses a PHP <a href="https://secure.php.net/manual/en/book.apc.php" target="_blank" rel="noreferrer">APC</a> extension. You can consider this option as the fastest one when dealing with cache for a centralized thick application (e.g., one server, no dedicated load balancers, etc.).</li><li><a href="https://github.com/yiisoft/cache-db" target="_blank" rel="noreferrer">Database</a> - uses a database table to store cached data.</li><li><a href="https://github.com/yiisoft/cache-file" target="_blank" rel="noreferrer">File</a> - uses standard files to store cached data. This is particularly suitable to cache large chunk of data, such as page content.</li><li><a href="https://github.com/yiisoft/cache-memcached" target="_blank" rel="noreferrer">Memcached</a> - uses a PHP <a href="https://secure.php.net/manual/en/book.memcached.php" target="_blank" rel="noreferrer">memcached</a> extension. You can consider this option as the fastest one when dealing with cache in distributed application (e.g., with several servers, load balancers, etc.)</li><li><a href="https://github.com/yiisoft/cache-wincache" target="_blank" rel="noreferrer">Wincache</a> - ses PHP <a href="https://iis.net/downloads/microsoft/wincache-extension" target="_blank" rel="noreferrer">WinCache</a> (<a href="https://secure.php.net/manual/en/book.wincache.php" target="_blank" rel="noreferrer">see also</a>) extension.</li></ul><p><a href="https://packagist.org/providers/psr/simple-cache-implementation" target="_blank" rel="noreferrer">You could find more handlers at packagist.org</a>.</p><blockquote><p>Tip: You may use different cache storage in the same application. A common strategy is:</p><ul><li>To use memory-based cache storage to store small but constantly used data (e.g., statistics)</li><li>To use file-based or database-based cache storage to store big and less often used data (e.g., page content)</li></ul></blockquote><p>Cache handlers are usually set up in a <a href="./../concept/di-container.html">dependency injection container</a> so that they can be globally configurable and accessible.</p><p>Because all cache handlers support the same set of APIs, you can swap the underlying cache handler with a different one. You can do it by reconfiguring the application without modifying the code that uses the cache.</p><h3 id="cache-keys" tabindex="-1">Cache keys <a class="header-anchor" href="#cache-keys" aria-label="Permalink to &quot;Cache keys&quot;">​</a></h3><p>A key uniquely identifies each data item stored in cache. When you store a data item in cache, you have to specify a key for it. Later, when you retrieve the data item from cache, you should give the corresponding key.</p><p>You may use a string or an arbitrary value as a cache key. When a key isn&#39;t a string, it will be automatically serialized into a string.</p><p>A common strategy of defining a cache key is to include all determining factors in terms of an array.</p><p>When different applications use the same cache storage, you should specify a unique cache key prefix for each application to avoid conflicts of cache keys. You can do this by using <code>\\Yiisoft\\Cache\\PrefixedCache</code> decorator:</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$arrayCacheWithPrefix </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\Yiisoft\\Cache\\PrefixedCache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\Yiisoft\\Cache\\ArrayCache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;myapp_&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$cache </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\Yiisoft\\Cache\\Cache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($arrayCacheWithPrefix);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="cache-expiration" tabindex="-1">Cache expiration <a class="header-anchor" href="#cache-expiration" aria-label="Permalink to &quot;Cache expiration&quot;">​</a></h3><p>A data item stored in a cache will remain there forever unless it&#39;s removed because of some caching policy enforcement. For example, caching space is full and cache storage removes the oldest data. To change this behavior, you can set a TTL parameter when calling a method to store a data item:</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$ttl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3600</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $cache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getOrSet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($key, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\Psr\\SimpleCache\\CacheInterface</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $cache) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ($count) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getTopProductsFromDatabase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($count);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}, $ttl);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>The <code>$ttl</code> parameter indicates for how many seconds the data item can remain valid in the cache. When you retrieve the data item, if it has passed the expiration time, the method will execute the function and set the resulting value into cache.</p><p>You may set default TTL for the cache:</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$cache </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\Yiisoft\\Cache\\Cache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($arrayCache, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 60</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1 hour</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Additionally, you can invalidate a cache key explicitly:</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$cache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">remove</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($key);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="invalidation-dependencies" tabindex="-1">Invalidation dependencies <a class="header-anchor" href="#invalidation-dependencies" aria-label="Permalink to &quot;Invalidation dependencies&quot;">​</a></h3><p>Besides the expiration setting, changes of the so-called <strong>invalidation dependencies</strong> may also invalidate cached data item. For example, <code>\\Yiisoft\\Cache\\Dependency\\FileDependency</code> represents the dependency of a file&#39;s modification time. When this dependency changes, it means something modifies the corresponding file. As a result, any outdated file content found in the cache should invalidate.</p><p>Cache dependencies are objects of <code>\\Yiisoft\\Cache\\Dependency\\Dependency</code> descendant classes. When you store a data item in the cache, you can pass along an associated cache dependency object. For example,</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@var</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> callable</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> $callable</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@var</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\Yiisoft\\Cache\\CacheInterface</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> $cache</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Yiisoft\\Cache\\Dependency\\TagDependency</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Set many cache values marking both with a tag.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$cache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getOrSet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;item_42_price&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, $callable, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> TagDependency</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;item_42&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$cache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getOrSet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;item_42_total&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, $callable, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3600</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> TagDependency</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;item_42&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Trigger invalidation by tag.</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TagDependency</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">invalidate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($cache, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;item_42&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>Below is a summary of the available cache dependencies:</p><ul><li><code>\\Yiisoft\\Cache\\Dependency\\ValueDependency</code>: invalidates the cache when specified value changes.</li><li><code>\\Yiisoft\\Cache\\Dependency\\CallbackDependency</code>: invalidates the cache when the result of the specified PHP callback is different.</li><li><code>\\Yiisoft\\Cache\\Dependency\\FileDependency</code>: invalidates the cache when the file&#39;s last modification time is different.</li><li><code>\\Yiisoft\\Cache\\Dependency\\TagDependency</code>: associates a cached data item with one or many tags. You may invalidate the cached data items with the specified tag(s) by calling <code>TagDependency::invalidate()</code>.</li></ul><p>You may combine many dependencies using <code>\\Yiisoft\\Cache\\Dependency\\AnyDependency</code> or <code>\\Yiisoft\\Cache\\Dependency\\AllDependencies</code>.</p><p>To implement your own dependency extend from <code>\\Yiisoft\\Cache\\Dependency\\Dependency</code>.</p><h3 id="cache-stampede-prevention" tabindex="-1">Cache stampede prevention <a class="header-anchor" href="#cache-stampede-prevention" aria-label="Permalink to &quot;Cache stampede prevention&quot;">​</a></h3><p><a href="https://en.wikipedia.org/wiki/Cache_stampede" target="_blank" rel="noreferrer">A cache stampede</a> is a type of cascading failure that can occur when massively parallel computing systems with caching mechanisms come under a high load. This behaviour is sometimes also called dog-piling. The <code>\\Yiisoft\\Cache\\Cache</code> uses a built-in &quot;Probably early expiration&quot; algorithm that prevents cache stampede. This algorithm randomly fakes a cache miss for one user while others are still served the cached value. You can control its behavior with the fifth optional parameter of <code>getOrSet()</code>, which is a float value called <code>$beta</code>. By default, beta is <code>1.0</code>, which is usually enough. The higher the value the earlier cache will be re-created.</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@var</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> mixed</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> $key</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@var</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> callable</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> $callable</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@var</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\DateInterval</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> $ttl</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@var</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\Yiisoft\\Cache\\CacheInterface</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> $cache</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@var</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\Yiisoft\\Cache\\Dependency\\Dependency</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> $dependency</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$beta </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$cache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getOrSet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($key, $callable, $ttl, $dependency, $beta);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div>`,41),h=[t];function l(p,r,c,d,k,o){return i(),a("div",null,h)}const u=s(n,[["render",l]]);export{y as __pageData,u as default};
